<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Welcome • Fitness & Nutrition Planner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* ===== Swap background here ===== */
    :root{
      --hero-image: url("https://images.unsplash.com/photo-1517836357463-d25dfeac3438?q=80&w=1600&auto=format&fit=crop");
      --ink:#0b1220; --panel:#0f172a; --muted:#94a3b8; --text:#e2e8f0; --sub:#cbd5e1;
      --brand:#22c55e; --brand-2:#3b82f6; --border:rgba(148,163,184,.18);
      --accent-glow: 0 20px 60px rgba(34,197,94,.35);
    }

    *{box-sizing:border-box}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, "Segoe UI", Roboto, Helvetica, Arial;
      color:var(--text); background:var(--ink); min-height:100vh; display:flex; flex-direction:column;
    }

    header{
      position: sticky; top:0; z-index:10;
      background:rgba(2,6,23,.55); backdrop-filter: blur(8px);
      border-bottom:1px solid var(--border);
      padding:14px 20px; display:flex; align-items:center; justify-content:center;
    }
    header h1{margin:0; font-size:1.15rem; letter-spacing:.3px}

    .hero{
      background:
        linear-gradient( to bottom, rgba(2,6,23,.35), rgba(2,6,23,.88) 75%, rgba(2,6,23,.95)),
        var(--hero-image) center/cover no-repeat;
      border-bottom:1px solid var(--border);
    }
    .hero-inner{
      max-width:1100px; margin:0 auto; padding:48px 18px 64px;   /* more bottom padding */
      display:grid; grid-template-columns:1.25fr .75fr; gap:20px;
    }
    @media (max-width:980px){ .hero-inner{grid-template-columns:1fr} }

    .hi{font-size:2.1rem; font-weight:800; line-height:1.15; margin:0 0 8px; text-transform:none}
    .tagline{margin:0; color:var(--sub); max-width:60ch}

    .wrap{max-width:1100px; width:100%; margin:24px auto 28px; padding:0 18px} /* no negative margin */
    .grid{display:grid; grid-template-columns:1fr 1fr; gap:18px; align-items:stretch} /* stretch */
    @media (max-width:980px){ .grid{grid-template-columns:1fr} }

    .card{
      background:linear-gradient(180deg, rgba(15,23,42,.86), rgba(10,17,34,.92));
      border:1px solid var(--border); border-radius:16px; padding:18px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      height:100%;                                /* equal heights in the row */
      display:flex; flex-direction:column;
    }
    h2{margin:0 0 10px; font-size:1.05rem; letter-spacing:.2px}
    p{margin:6px 0; color:var(--muted)}
    .hint{font-size:.9rem; color:var(--sub)}

    label{display:block; font-size:.92rem; color:var(--sub); margin:10px 0 6px}
    input,select{
      width:100%; padding:12px 12px; border-radius:12px;
      border:1px solid var(--border); background:#081326; color:var(--text); outline:none;
    }
    input:focus{box-shadow:0 0 0 2px rgba(59,130,246,.35)}
    .row2{display:grid; grid-template-columns:1fr 1fr; gap:10px}

    .actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
    .btn{border:0; border-radius:12px; padding:12px 16px; font-weight:700; cursor:pointer; letter-spacing:.2px}
    .btn-green{background:var(--brand); color:#052e16; box-shadow: var(--accent-glow)}
    .btn-blue{background:var(--brand-2); color:#e6f0ff}
    .btn-ghost{background:transparent; color:#cfe1ff; border:1px solid #60a5fa}
    .btn-soft{background:#0b1530; border:1px solid var(--border); color:#e2e8f0}

    .checklist{margin:8px 0 0 18px; color:var(--sub); line-height:1.6}
    .spacer{flex:1 1 auto}
    footer{padding:8px 0 24px; text-align:center; color:var(--muted)}
    .toast{margin-top:10px; font-size:.95rem}
    .ok{color:#34d399} .err{color:#f87171}
  </style>
</head>
<body>
  <header><h1>Fitness & Nutrition Planner</h1></header>

  <section class="hero">
    <div class="hero-inner">
      <div>
        <h2 id="hi" class="hi">Hi!</h2>
        <p class="tagline">
          Track meals, log workouts, and hit your targets. We’ll calculate calories and macros
          from your plan—just keep showing up. Let’s set the basics now.
        </p>
      </div>

      <div class="card" style="align-self:flex-start">
        <h2>Quick Start</h2>
        <p class="hint">You can change these anytime in your profile.</p>
        <div class="row2">
          <div>
            <label>Height (cm)</label>
            <input id="heightCm" type="number" min="80" max="250" step="0.1" placeholder="e.g., 170" />
          </div>
          <div>
            <label>Weight (kg)</label>
            <input id="weightKg" type="number" min="30" max="300" step="0.1" placeholder="e.g., 70" />
          </div>
        </div>
        <div class="actions">
          <button class="btn btn-green" onclick="saveHW()">Save Height & Weight</button>
          <button class="btn btn-ghost" onclick="gotoDashboard()">Skip for now → Dashboard</button>
        </div>
        <div id="hwToast" class="toast"></div>
      </div>
    </div>
  </section>

  <div class="wrap">
    <div class="grid">
      <section class="card">
        <h2>Create your plan</h2>
        <p>
          Your plan sets your daily calories and macros automatically based on your goal
          (lose, maintain, or gain). It powers your dashboard and progress.
        </p>
        <div class="spacer"></div>
        <div class="actions">
          <button class="btn btn-blue" onclick="openCreatePlan()">Create / Update Plan</button>
          <button class="btn btn-soft" onclick="gotoDashboard()">I’ll do this later</button>
        </div>
        <p class="hint">After you save the plan, you’ll be redirected to your dashboard.</p>
      </section>

      <section class="card">
        <h2>What’s next?</h2>
        <ul class="checklist">
          <li>Log your first meal and workout on the Dashboard.</li>
          <li>Watch “Consumed”, “Burned”, and macros update in real time.</li>
          <li>Come back to adjust height/weight or plan as you progress.</li>
        </ul>
        <div class="spacer"></div>
        <div class="actions" style="margin-top:14px">
          <button class="btn btn-ghost" onclick="gotoDashboard()">Open Dashboard</button>
        </div>
      </section>
    </div>
  </div>

  <footer>© <span id="yr"></span> Fitness & Nutrition Planner</footer>

  <script>
    // Guard
    const user = JSON.parse(localStorage.getItem('user') || 'null');
    if (!user) location.href = '/login.html';

    // Title-case helper
    const titleCase = s => String(s||'').toLowerCase().replace(/\b\w/g,c=>c.toUpperCase());

    // Greet
    const name = user.name ? titleCase(user.name) : (user.email || 'there');
    document.getElementById('hi').textContent = `Hi, ${name}!`;
    document.getElementById('yr').textContent = new Date().getFullYear();

    // Prefill height/weight if present
    (async function loadUser(){
      try{
        const r = await fetch(`/api/user/${user.userId}`, { cache:'no-store' });
        if (r.ok){
          const u = await r.json();
          if (u.name) document.getElementById('hi').textContent = `Hi, ${titleCase(u.name)}!`;
          if (u.heightCm) document.getElementById('heightCm').value = u.heightCm;
          if (u.weightKg) document.getElementById('weightKg').value = u.weightKg;
        }
      }catch(e){ console.error(e); }
    })();

    // Save H/W with a couple of fallback endpoints
    async function saveHW(){
      const heightCm = document.getElementById('heightCm').value;
      const weightKg = document.getElementById('weightKg').value;
      if (!heightCm || !weightKg) return toast('hwToast','Please enter both height and weight', true);

      const body = JSON.stringify({ heightCm: Number(heightCm), weightKg: Number(weightKg) });
      const trials = [
        { url:`/api/user/${user.userId}`, opts:{ method:'PUT',  headers:{'Content-Type':'application/json'}, body } },
        { url:`/api/user/update?userId=${user.userId}&heightCm=${encodeURIComponent(heightCm)}&weightKg=${encodeURIComponent(weightKg)}`, opts:{ method:'POST' } },
        { url:`/api/user/${user.userId}/metrics?heightCm=${encodeURIComponent(heightCm)}&weightKg=${encodeURIComponent(weightKg)}`, opts:{ method:'PATCH' } },
      ];
      for (const t of trials){
        try{ const res = await fetch(t.url, t.opts); if (res.ok){ toast('hwToast','Saved ✔'); return; } }catch(e){}
      }
      toast('hwToast','Save failed. Check your user update endpoint.', true);
    }

    function openCreatePlan(){
      const qs = new URLSearchParams({ userId: user.userId, redirect: '/user_dashboard.html' });
      location.href = `/create_plan.html?${qs.toString()}`;
    }
    function gotoDashboard(){ location.href = '/user_dashboard.html'; }

    function toast(id,msg,isErr=false){
      const el = document.getElementById(id);
      el.textContent = msg; el.className = `toast ${isErr?'err':'ok'}`;
      setTimeout(()=>{ el.textContent=''; el.className='toast'; }, 3200);
    }
  </script>
</body>
</html>
